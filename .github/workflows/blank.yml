name: WireGuard VPN Setup and Hold

on:
  push:
    branches:
      - main
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –≤–∫–ª–∞–¥–∫—É "Actions"

jobs:
  vpn_hold:
    runs-on: ubuntu-latest
    timeout-minutes: 360 # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∞—É—Ç (6 —á–∞—Å–æ–≤)
    
    steps:
      - name: üìù Checkout Code
        uses: actions/checkout@v4

      # ‚û°Ô∏è –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WireGuard
      - name: üõ°Ô∏è Set up WireGuard VPN Client
        uses: egor-tensin/setup-wireguard@v1
        with:
          # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP —Ä–∞–Ω–µ—Ä–∞
          ips: '10.0.0.2/32' 
          # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Ä–∞–Ω–µ—Ä–∞ (–∏–∑ Secrets)
          private_key: ${{ secrets.WG_PRIVATE_KEY }}
          
          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∏—Ä–∞ (–í–∞—à–µ–≥–æ VPN-—Å–µ—Ä–≤–µ—Ä–∞)
          endpoint_public_key: ${{ secrets.WG_ENDPOINT }}
          public_key: ${{ secrets.WG_PUBLIC_KEY }}
          allowed_ips: ${{ secrets.WG_ALLOWED_IPS }}

      - name: üîé Verify VPN Setup
        run: |
          echo "WireGuard Interface Status:"
          ip a show wg0
          echo "Network Routes:"
          ip r | grep 'wg0'
          
      # ‚è≥ –®–∞–≥ 3: –¢–†–Æ–ö "–ó–ê–ú–û–†–û–ó–ö–ò" - –ù–µ –¥–∞–µ—Ç Workflow –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
      - name: üî¥ KEEP
        run: |
          echo "üî• Runner is now 'active' for up to 6 hours."
          echo "Connecting to this runner from outside is highly unlikely due to GitHub's network setup."
          # 6 —á–∞—Å–æ–≤ = 21600 —Å–µ–∫—É–Ω–¥. –ö–æ–º–∞–Ω–¥–∞ 'sleep' –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤—Å–µ —ç—Ç–æ –≤—Ä–µ–º—è.
          sleep 21600 
          echo "Workflow finished after sleep."
